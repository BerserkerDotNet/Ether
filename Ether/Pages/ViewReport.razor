@page "/reports/view/{type}/{id:guid}"
@inject EtherClient Client
@inject IUriHelper UriHelper
@inject JsUtils JsUtils

<Ether.Components.Card>
    <Header>
        @reportDisplayName
        <div class="d-print-none pull-right d-print-none">
            <button class="btn btn-fill btn-secondary" onclick="@Print">Print</button>
            <button class="btn btn-fill btn-info" onclick="@NewReport">New report</button>
            <button class="btn btn-fill btn-success" onclick="@BackToList">Back to list</button>
        </div>
    </Header>
    <Body>
        @componentToRender
    </Body>
    <Footer></Footer>
</Ether.Components.Card>
@functions
{
    private string reportDisplayName = string.Empty;
    RenderFragment componentToRender;

    [Parameter]
    private Guid? Id { get; set; }

    [Parameter]
    private string Type { get; set; }

    protected override void OnParametersSet()
    {
        // TODO: that is not going to fly
        if (string.Equals(Type, "PullRequestsReport", StringComparison.OrdinalIgnoreCase))
        {
            reportDisplayName = "Pull requests report";
            componentToRender = b => RenderComponent<Ether.Components.Reports.PullRequestsReport>(b);
        }
        else if (string.Equals(Type, "AggregatedWorkitemsETAReport", StringComparison.OrdinalIgnoreCase))
        {
            reportDisplayName = "Aggregated workitems ETA report";
            componentToRender = b => RenderComponent<Ether.Components.Reports.AggregatedWorkitemsETAReport>(b);
        }
        else if (string.Equals(Type, "WorkitemsReporter", StringComparison.OrdinalIgnoreCase))
        {
            reportDisplayName = "Workitems report";
            componentToRender = b => RenderComponent<Ether.Components.Reports.WorkitemsReport>(b);
        }
    }

    protected void RenderComponent<T>(Microsoft.AspNetCore.Components.RenderTree.RenderTreeBuilder builder)
        where T : IComponent
    {
        builder.OpenComponent<T>(1);
        builder.AddAttribute(2, "Id", Id.Value);
        builder.CloseComponent();
    }

    protected void BackToList()
    {
        UriHelper.NavigateTo("/reports");
    }

    protected void NewReport()
    {
        UriHelper.NavigateTo("/");
    }

    protected void Print()
    {
        JsUtils.Print();
    }
}
